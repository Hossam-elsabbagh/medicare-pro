{% extends "superadmin/base.html" %}

{% block title %}Admins - Super Admin{% endblock %}

{% block header_title %}Super Admins Management{% endblock %}
{% block header_subtitle %}Manage super administrator accounts{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="page-title">Super Administrators</h2>
    <a href="{{ url_for('superadmin_create_admin') }}" class="btn btn-primary btn-custom">
        <i class="fas fa-user-plus me-2"></i>Add New Super Admin
    </a>
</div>

<!-- Super Admins Table -->
<div class="table-custom">
    {% if admins %}
    <table class="table table-hover mb-0">
        <thead>
            <tr>
                <th>Admin Details</th>
                <th>Email</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for admin in admins %}
            <tr class="{{ 'table-warning' if admin.id == current_user.id }}">
                <td>
                    <div class="d-flex align-items-center">
                        <div class="stats-icon bg-gradient-warning me-3" style="width: 45px; height: 45px; font-size: 18px;">
                            <i class="fas fa-{{ 'crown' if admin.id == current_user.id else 'user-shield' }}"></i>
                        </div>
                        <div>
                            <h6 class="mb-1">
                                {{ admin.username }}
                                {% if admin.id == current_user.id %}
                                <span class="badge bg-warning text-dark ms-2">You</span>
                                {% endif %}
                            </h6>
                            <small class="text-muted">ID: {{ admin.id }}</small>
                        </div>
                    </div>
                </td>
                <td>
                    <i class="fas fa-envelope text-muted me-1"></i>{{ admin.email }}
                </td>
                <td>
                    <span class="badge badge-custom bg-{{ 'success' if admin.is_active else 'danger' }}">
                        {{ 'Active' if admin.is_active else 'Inactive' }}
                    </span>
                </td>
                <td>
                    {% if admin.last_login %}
                    {% set utc_time = admin.last_login | utc_time %}
                    <small class="text-muted">{{ utc_time.strftime('%b %d, %Y at %I:%M %p') if utc_time else 'Never' }}</small>
                    <br><small class="text-muted" style="font-size: 0.8em;">UTC</small>
                    {% else %}
                    <small class="text-muted">Never logged in</small>
                    {% endif %}
                </td>
                <td>
                    <small class="text-muted">{{ admin.created_at.strftime('%b %d, %Y') }}</small>
                </td>
                <td>
                    {% if admin.id != current_user.id %}
                    <button class="btn btn-outline-{{ 'danger' if admin.is_active else 'success' }} btn-sm" 
                            onclick="toggleAdminStatus({{ admin.id }}, {{ admin.is_active|lower }}, '{{ admin.username }}')"
                            title="{{ 'Deactivate' if admin.is_active else 'Activate' }}">
                        <i class="fas fa-{{ 'pause' if admin.is_active else 'play' }}"></i>
                        {{ 'Deactivate' if admin.is_active else 'Activate' }}
                    </button>
                    {% else %}
                    <small class="text-muted">Current User</small>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-users-cog text-muted mb-3" style="font-size: 4rem;"></i>
        <h4 class="text-muted">No super admins found</h4>
        <p class="text-muted">This shouldn't happen! There should be at least one super admin.</p>
        <a href="{{ url_for('superadmin_create_admin') }}" class="btn btn-primary btn-custom">
            <i class="fas fa-user-plus me-2"></i>Create Super Admin
        </a>
    </div>
    {% endif %}
</div>

<!-- Security Notice -->
<div class="alert alert-warning mt-4">
    <h6><i class="fas fa-shield-alt me-2"></i>Security Notice</h6>
    <ul class="mb-0">
        <li>Super Admins have full system access and can manage all clinics and doctors</li>
        <li>Only trusted personnel should be given Super Admin privileges</li>
        <li>You cannot deactivate your own account for security reasons</li>
        <li>Always ensure there is at least one active Super Admin in the system</li>
    </ul>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleAdminStatus(adminId, isActive, username) {
    const action = isActive ? 'deactivate' : 'activate';
    if (confirm(`Are you sure you want to ${action} Super Admin "${username}"?\n\nThis will ${action} their access to the system.`)) {
        fetch(`/superadmin/admin/${adminId}/toggle-status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            location.reload(); // Reload on error to show flash messages
        });
    }
}
</script>
{% endblock %}