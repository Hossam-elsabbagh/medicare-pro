{% extends "base.html" %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: linear-gradient(135deg,#e0e7ff 0%,#f0fdfa 100%); min-height:100vh; }
  .modern-card { border-radius:1.5rem; background:#fff; box-shadow:0 8px 32px rgba(31,38,135,.15); border:none; padding:2.5rem 2rem; animation:fadeInUp .9s; }
  @keyframes fadeInUp { from { opacity:0; transform:translate3d(0,40px,0);} to { opacity:1; transform:none;} }
  .modern-title { font-weight:800; letter-spacing:1px; color:#3b82f6; margin-bottom:2rem; }
  .form-label { color:#374151; font-size:1.05rem; }
  .form-control-lg { border-radius:.75rem; border:1.5px solid #dbeafe; background:#f8fafc; transition:border-color .2s; }
  .form-control-lg:focus { border-color:#3b82f6; box-shadow:0 0 0 2px #93c5fd55; background:#fff; }
  .btn-primary { background:linear-gradient(90deg,#3b82f6 0%,#06b6d4 100%); border:none; border-radius:.75rem; font-weight:700; letter-spacing:1px; box-shadow:0 4px 16px #3b82f633; transition:background .2s, box-shadow .2s; }
  .btn-primary:hover { background:linear-gradient(90deg,#2563eb 0%,#0ea5e9 100%); box-shadow:0 6px 24px #3b82f655; }
  .custom-file input[type=file] { padding:.5rem .75rem; border-radius:.75rem; background:#f8fafc; border:1.5px solid #dbeafe; }
  .existing-images img { width:110px; height:85px; object-fit:cover; border-radius:8px; margin:4px; border:2px solid #e2e8f0; }
</style>
<div class="container d-flex align-items-center justify-content-center" style="min-height:100vh;">
  <div class="modern-card w-100" style="max-width:560px;">
    <h2 class="modern-title text-center">Edit Visit (Patient: {{ patient.name }})</h2>
    <form method="POST" enctype="multipart/form-data" autocomplete="off">
      {{ form.hidden_tag() }}
      <div class="mb-3">
        {{ form.visit_date.label(class="form-label fw-semibold") }}
        {{ form.visit_date(class="form-control form-control-lg") }}
      </div>
      <div class="mb-3">
        {{ form.diagnosis.label(class="form-label fw-semibold") }}
        {{ form.diagnosis(class="form-control form-control-lg", rows=3) }}
      </div>
      <div class="mb-3">
        {{ form.medications.label(class="form-label fw-semibold") }}
        {{ form.medications(class="form-control form-control-lg", rows=3) }}
      </div>
      <div class="row mb-3">
        <div class="col-md-6 mb-3 mb-md-0">
          {{ form.amount_due.label(class="form-label fw-semibold") }}
          {{ form.amount_due(class="form-control form-control-lg", step="0.01") }}
        </div>
        <div class="col-md-6">
          {{ form.amount_paid.label(class="form-label fw-semibold") }}
          {{ form.amount_paid(class="form-control form-control-lg", step="0.01") }}
        </div>
      </div>
      {% if visit.xray_filenames %}
      <div class="mb-3 existing-images">
        <label class="form-label fw-semibold">Existing Images (select to delete)</label><br>
        <div class="d-flex flex-wrap">
        {% for filename in visit.xray_filenames.split(',') %}
          <div class="position-relative m-1" style="width:110px;">
            <img src="{{ url_for('static', filename='xrays/' + filename) }}" alt="Existing Image" class="w-100 rounded" style="height:85px;object-fit:cover;">
            <div class="form-check position-absolute" style="top:4px; left:4px; background:rgba(255,255,255,0.7); padding:2px 4px; border-radius:4px;">
              <input class="form-check-input" type="checkbox" name="delete_images" value="{{ filename }}" id="del_{{ loop.index }}">
            </div>
          </div>
        {% endfor %}
        </div>
        <small class="text-danger">Checked images will be permanently deleted on save.</small>
      </div>
      {% endif %}
      <div class="mb-3">
        {{ form.xray.label(class="form-label fw-semibold") }}
        <div class="custom-file">
          {{ form.xray(class="form-control", multiple=True) }}
        </div>
        <small class="text-muted">Selecting new images will append to the existing ones.</small>
      </div>
      <div class="d-grid mt-4">
        {{ form.submit(class="btn btn-primary btn-lg") }}
      </div>
    </form>
  </div>
</div>
{% endblock %}
